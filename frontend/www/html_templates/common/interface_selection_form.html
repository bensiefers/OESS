<template id="template-interface-selection-form">
    <div>
        <div class="form-group">
            <label class="control-label">Node</label>
            <select class="form-control select-node"></select>
        </div>
        <div class="form-group">
            <label class="control-label">Interface</label>
            <select class="form-control select-port"></select>
        </div>
        <div class="form-group">
            <label class="control-label">VLAN</label>
            <select class="form-control select-vlan"></select>
        </div>
        <div class="form-group">
            <label class="control-label">Max Bandwidth (Mb/s)</label>
            <input class="form-control input-bandwidth" placeholder="Unlimited" type="number" min="10" max="100000"/>
        </div>

        <button class="btn btn-success button-submit" type="submit">Add Endpoint</button>
        <button class="btn btn-danger button-cancel" type="button">Cancel</button>
    </div>
</template>

<script>
 class InterfaceSelectionForm {
     constructor(parent) {
         let template = document.querySelector('#template-interface-selection-form');
         this.element = document.importNode(template.content, true);
        
         let nodeSelect = this.element.querySelector('.select-node');
         nodeSelect.onchange = async function(event) {
             let node = event.target.value;
             let ports = await getInterfaces(session.data.workgroup_id, node, 0);
             this.setPorts(ports);
         }.bind(this);

         let portSelect = this.element.querySelector('.select-port');
         portSelect.onchange = async function(event) {
             let port = event.target.value;
             let vlans = await getAvailableVLANs(session.data.workgroup_id, port);
             this.setVlans(vlans);
         }.bind(this);

         this.parent = parent;
         this.parent.appendChild(this.element);
     }

     setNodes(nodes) {
         let select = this.parent.querySelector('.select-node');
         select.innerHTML = '';

         for (let i = 0; i < nodes.length; i++) {
             let option = document.createElement('option');
             option.innerText = `${nodes[i].name}`;
             option.setAttribute('value', nodes[i].name);
             select.appendChild(option);

             if (i === 0) {
                 option.setAttribute('selected', true);
             }
         }

         let event = new Event('change');
         select.dispatchEvent(event);
     }

     setPorts(ports) {
         let select = this.parent.querySelector('.select-port');
         select.innerHTML = '';

         for (let i = 0; i < ports.length; i++) {
             let option = document.createElement('option');
             option.innerText = `${ports[i].name}`;
             option.setAttribute('value', ports[i].interface_id);
             select.appendChild(option);

             if (i === 0) {
                 option.setAttribute('selected', true);
             }
         }

         let event = new Event('change');
         select.dispatchEvent(event);
     }

     setVlans(vlans) {
         let select = this.parent.querySelector('.select-vlan');
         select.innerHTML = '';

         for (let i = 0; i < vlans.length; i++) {
             let option = document.createElement('option');
             option.innerText = `${vlans[i]}`;
             option.setAttribute('value', vlans[i]);
             select.appendChild(option);

             if (i === 0) {
                 option.setAttribute('selected', true);
             }
         }

         let event = new Event('change');
         select.dispatchEvent(event);
     }
 }
</script>
